var fivebeans = require('fivebeans');

var joblist = [
	'one',
	'two',
	'three',
	'four',
	'five'
];

var doneEmittingJobs = function()
{
	console.log('We reached our completion callback. Now closing down.');
	emitter.end();
	process.exit(0);
};

var continuer = function(err, jobid)
{
	console.log('emitted job id: ' + jobid);
	if (joblist.length === 0)
		return doneEmittingJobs();

	emitter.put(0, 0, 60, JSON.stringify(['testtube', joblist.shift()]), continuer);
};

var emitter = new fivebeans.client('localhost', 11300);
emitter.connect(function(err)
{
	emitter.use('testtube', function(err, tname)
	{
		console.log("using " + tname);
		emitter.put(0, 0, 60, JSON.stringify(['testtube', joblist.shift()]), continuer);
	});
});
